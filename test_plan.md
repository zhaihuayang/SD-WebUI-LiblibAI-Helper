# liblibAI 插件测试计划

## 1. 概述

本测试计划旨在确保 liblibAI 插件的质量和稳定性。测试将涵盖以下方面：

- 单元测试：测试各个组件的独立功能
- 集成测试：测试组件之间的交互
- UI 测试：测试前端界面的功能和用户体验
- 端到端测试：测试完整的用户流程
- 手动测试：提供给用户的手动测试清单

## 2. 测试环境

- 操作系统：Windows 10/11, macOS, Linux
- Python 版本：3.8+
- Stable Diffusion WebUI 版本：1.5.0+
- 浏览器：Chrome, Firefox, Edge

## 3. 测试范围

### 3.1 单元测试

#### 3.1.1 认证模块 (auth.py)

| 测试 ID | 测试名称 | 测试描述 | 预期结果 |
|---------|---------|---------|---------|
| UT-A-001 | 测试初始化 | 测试 LiblibAIAuth 类的初始化 | 对象成功创建，属性正确设置 |
| UT-A-002 | 测试加载密钥 | 测试从配置文件加载 API 密钥 | 密钥正确加载 |
| UT-A-003 | 测试保存密钥 | 测试保存 API 密钥到配置文件 | 密钥正确保存 |
| UT-A-004 | 测试生成签名 | 测试 API 请求签名生成 | 签名正确生成 |
| UT-A-005 | 测试配置状态 | 测试 is_configured 方法 | 正确返回配置状态 |
| UT-A-006 | 测试认证测试 | 测试 test_authentication 方法 | 正确返回认证状态 |
| UT-A-007 | 测试无密钥签名 | 测试在无密钥情况下生成签名 | 抛出 ValueError 异常 |
| UT-A-008 | 测试不同参数签名 | 测试使用不同参数生成签名 | 签名正确生成并包含参数 |

#### 3.1.2 API 通信模块 (api.py)

| 测试 ID | 测试名称 | 测试描述 | 预期结果 |
|---------|---------|---------|---------|
| UT-B-001 | 测试初始化 | 测试 LiblibAIAPI 类的初始化 | 对象成功创建，属性正确设置 |
| UT-B-002 | 测试设置代理 | 测试设置和清除代理 | 代理正确设置和清除 |
| UT-B-003 | 测试请求方法 | 测试 _request 方法的基本功能 | 请求正确发送，返回结果正确 |
| UT-B-004 | 测试请求异常 | 测试请求异常处理 | 异常正确捕获并转换为 APIError |
| UT-B-005 | 测试文生图 | 测试 text_to_image 方法 | 请求正确发送，参数正确设置 |
| UT-B-006 | 测试图生图 | 测试 image_to_image 方法 | 请求正确发送，图片正确处理 |
| UT-B-007 | 测试获取任务结果 | 测试 get_task_result 方法 | 请求正确发送，参数正确设置 |
| UT-B-008 | 测试获取模型列表 | 测试 get_models 方法 | 请求正确发送，参数正确设置 |
| UT-B-009 | 测试获取工作流模板 | 测试 get_workflow_templates 方法 | 请求正确发送 |
| UT-B-010 | 测试运行工作流 | 测试 run_workflow 方法 | 请求正确发送，参数正确设置 |
| UT-B-011 | 测试获取模型预设 | 测试 get_model_presets 方法 | 请求正确发送，参数正确设置 |
| UT-B-012 | 测试星流 Star-3 Alpha | 测试 star3_alpha 方法 | 请求正确发送，参数正确设置 |
| UT-B-013 | 测试文件路径处理 | 测试图片文件路径处理 | 文件正确读取并编码为 base64 |
| UT-B-014 | 测试不支持的请求方法 | 测试使用不支持的请求方法 | 抛出 ValueError 异常 |

### 3.2 集成测试

#### 3.2.1 主入口文件 (liblibai_helper.py)

| 测试 ID | 测试名称 | 测试描述 | 预期结果 |
|---------|---------|---------|---------|
| IT-A-001 | 测试加载设置 | 测试 load_settings 函数 | 设置正确加载，auth 和 api 对象正确初始化 |
| IT-A-002 | 测试保存设置 | 测试 save_settings 函数 | 设置正确保存到文件 |
| IT-A-003 | 测试更新嵌套字典 | 测试 update_nested_dict 函数 | 嵌套字典正确更新 |
| IT-A-004 | 测试确保目录存在 | 测试 ensure_directory 函数 | 目录正确创建 |
| IT-A-005 | 测试创建 UI | 测试 on_ui_tabs 函数 | UI 选项卡正确创建 |
| IT-A-006 | 测试生成 UI | 测试 create_generation_ui 函数 | 生成 UI 正确创建 |
| IT-A-007 | 测试工作流 UI | 测试 create_workflow_ui 函数 | 工作流 UI 正确创建 |
| IT-A-008 | 测试模型 UI | 测试 create_models_ui 函数 | 模型 UI 正确创建 |
| IT-A-009 | 测试任务 UI | 测试 create_tasks_ui 函数 | 任务 UI 正确创建 |
| IT-A-010 | 测试设置 UI | 测试 create_settings_ui 函数 | 设置 UI 正确创建 |
| IT-A-011 | 测试加载模型列表 | 测试 load_models 函数 | 模型列表正确加载 |
| IT-A-012 | 测试生成图像 | 测试 generate_image 函数 | 图像正确生成 |
| IT-A-013 | 测试加载工作流列表 | 测试 load_workflows 函数 | 工作流列表正确加载 |
| IT-A-014 | 测试运行工作流 | 测试 run_workflow 函数 | 工作流正确运行 |
| IT-A-015 | 测试加载模型列表 | 测试 load_models_list 函数 | 模型列表正确加载和过滤 |
| IT-A-016 | 测试获取任务状态 | 测试 get_task_status 函数 | 任务状态正确获取 |
| IT-A-017 | 测试获取最近任务 | 测试 get_recent_tasks 函数 | 最近任务列表正确获取 |
| IT-A-018 | 测试保存设置 | 测试 save_settings_func 函数 | 设置正确保存 |
| IT-A-019 | 测试测试连接 | 测试 test_connection 函数 | 连接测试正确执行 |

#### 3.2.2 前端脚本 (liblibai_helper.js)

| 测试 ID | 测试名称 | 测试描述 | 预期结果 |
|---------|---------|---------|---------|
| IT-B-001 | 测试初始化 | 测试 initLiblibAIHelper 函数 | 插件正确初始化 |
| IT-B-002 | 测试监听元素变化 | 测试 observeElementChanges 函数 | 元素变化正确监听 |
| IT-B-003 | 测试增强模型卡片 | 测试 enhanceModelCards 函数 | 模型卡片正确增强 |
| IT-B-004 | 测试增强单个模型卡片 | 测试 enhanceModelCard 函数 | 单个模型卡片正确增强 |
| IT-B-005 | 测试切换到 LiblibAI 选项卡 | 测试 switchToLiblibAITab 函数 | 正确切换到 LiblibAI 选项卡 |
| IT-B-006 | 测试搜索并选择模型 | 测试 searchAndSelectModel 函数 | 正确搜索并选择模型 |
| IT-B-007 | 测试增强提示词输入框 | 测试 enhancePromptTextarea 函数 | 提示词输入框正确增强 |

### 3.3 UI 测试

| 测试 ID | 测试名称 | 测试描述 | 预期结果 |
|---------|---------|---------|---------|
| UI-001 | 测试生成选项卡 | 测试生成选项卡的 UI 元素和交互 | 所有元素正确显示和交互 |
| UI-002 | 测试工作流选项卡 | 测试工作流选项卡的 UI 元素和交互 | 所有元素正确显示和交互 |
| UI-003 | 测试模型选项卡 | 测试模型选项卡的 UI 元素和交互 | 所有元素正确显示和交互 |
| UI-004 | 测试任务选项卡 | 测试任务选项卡的 UI 元素和交互 | 所有元素正确显示和交互 |
| UI-005 | 测试设置选项卡 | 测试设置选项卡的 UI 元素和交互 | 所有元素正确显示和交互 |
| UI-006 | 测试模型卡片增强 | 测试模型卡片的增强功能 | 增强按钮正确显示和工作 |
| UI-007 | 测试提示词输入框增强 | 测试提示词输入框的增强功能 | 增强按钮正确显示和工作 |
| UI-008 | 测试响应式布局 | 测试 UI 在不同屏幕尺寸下的表现 | UI 正确适应不同屏幕尺寸 |

### 3.4 端到端测试

| 测试 ID | 测试名称 | 测试描述 | 预期结果 |
|---------|---------|---------|---------|
| E2E-001 | 测试文生图流程 | 测试完整的文生图流程 | 图像成功生成并显示 |
| E2E-002 | 测试图生图流程 | 测试完整的图生图流程 | 图像成功生成并显示 |
| E2E-003 | 测试工作流流程 | 测试完整的工作流流程 | 工作流成功运行并显示结果 |
| E2E-004 | 测试模型搜索流程 | 测试模型搜索和使用流程 | 模型成功搜索并使用 |
| E2E-005 | 测试任务管理流程 | 测试任务创建和查询流程 | 任务成功创建和查询 |
| E2E-006 | 测试设置管理流程 | 测试设置保存和加载流程 | 设置成功保存和加载 |
| E2E-007 | 测试模型卡片集成流程 | 测试从模型卡片到 LiblibAI 的流程 | 成功从模型卡片切换到 LiblibAI |
| E2E-008 | 测试提示词集成流程 | 测试从提示词输入框到 LiblibAI 的流程 | 成功从提示词输入框切换到 LiblibAI |

## 4. 测试方法

### 4.1 单元测试

单元测试将使用 Python 的 unittest 框架和 pytest 进行。测试将包括：

- 正常情况测试：测试组件在正常条件下的行为
- 边缘情况测试：测试组件在边缘条件下的行为
- 异常情况测试：测试组件在异常条件下的行为

测试将使用模拟（mock）对象来模拟外部依赖，如文件系统和网络请求。

### 4.2 集成测试

集成测试将使用 Python 的 unittest 框架和 pytest 进行。测试将包括：

- 组件交互测试：测试组件之间的交互
- 数据流测试：测试数据在组件之间的流动
- 异常处理测试：测试异常在组件之间的传播

集成测试将使用模拟对象来模拟外部系统，但会使用真实的组件进行交互测试。

### 4.3 UI 测试

UI 测试将使用 Selenium 或 Playwright 进行。测试将包括：

- 元素存在测试：测试 UI 元素是否正确显示
- 交互测试：测试 UI 元素的交互功能
- 视觉测试：测试 UI 的视觉表现

UI 测试将在真实的浏览器环境中进行，模拟用户的操作。

### 4.4 端到端测试

端到端测试将使用 Selenium 或 Playwright 进行。测试将包括：

- 用户流程测试：测试完整的用户流程
- 系统集成测试：测试与外部系统的集成
- 性能测试：测试系统在负载下的表现

端到端测试将在真实的环境中进行，模拟真实用户的操作。

## 5. 手动测试清单

以下是用户可以遵循的手动测试清单，用于验证插件的功能：

### 5.1 安装和配置

1. 安装插件
   - 下载插件
   - 运行安装脚本
   - 验证插件是否正确安装

2. 配置插件
   - 打开设置选项卡
   - 输入 Access Key 和 Secret Key
   - 点击保存设置
   - 点击测试连接
   - 验证连接是否成功

### 5.2 基本功能

1. 文生图
   - 选择一个模型
   - 输入提示词和负面提示词
   - 设置参数（宽度、高度、步数等）
   - 点击生成按钮
   - 验证图像是否成功生成

2. 图生图
   - 选择一个模型
   - 上传一张图片
   - 输入提示词和负面提示词
   - 设置参数
   - 点击生成按钮
   - 验证图像是否成功生成

3. 工作流
   - 选择一个工作流
   - 设置工作流参数
   - 点击运行工作流按钮
   - 验证工作流是否成功运行

### 5.3 高级功能

1. 模型管理
   - 打开模型选项卡
   - 选择不同的模型类型
   - 搜索模型
   - 验证模型列表是否正确显示

2. 任务管理
   - 打开任务选项卡
   - 输入一个任务 ID
   - 点击刷新任务状态
   - 验证任务状态是否正确显示
   - 点击刷新最近任务
   - 验证最近任务列表是否正确显示

3. 模型卡片集成
   - 在 WebUI 中找到一个模型卡片
   - 点击 "使用 LiblibAI" 按钮
   - 验证是否成功切换到 LiblibAI 选项卡
   - 验证模型是否被正确选择

4. 提示词集成
   - 在 WebUI 中输入提示词和负面提示词
   - 点击 "发送到 LiblibAI" 按钮
   - 验证是否成功切换到 LiblibAI 选项卡
   - 验证提示词和负面提示词是否被正确填充

## 6. 测试执行计划

1. 单元测试
   - 为 auth.py 编写单元测试
   - 为 api.py 编写单元测试
   - 运行单元测试并修复问题

2. 集成测试
   - 为 liblibai_helper.py 设计集成测试
   - 为前端组件设计 UI 测试
   - 运行集成测试并修复问题

3. UI 测试
   - 设计 UI 测试用例
   - 运行 UI 测试并修复问题

4. 端到端测试
   - 设计端到端测试用例
   - 运行端到端测试并修复问题

5. 手动测试
   - 执行手动测试清单
   - 记录问题并修复

## 7. 测试报告

测试报告将包括以下内容：

- 测试摘要：测试执行的总体情况
- 测试结果：每个测试用例的结果
- 问题列表：发现的问题和状态
- 改进建议：对插件的改进建议

## 8. 测试维护

测试将根据插件的更新进行维护：

- 添加新功能时，添加相应的测试用例
- 修复问题时，添加回归测试
- 定期运行自动化测试，确保插件的质量

## 9. 结论

本测试计划提供了一个全面的测试策略，涵盖了 liblibAI 插件的所有方面。通过执行这些测试，可以确保插件的质量和稳定性，为用户提供良好的体验。